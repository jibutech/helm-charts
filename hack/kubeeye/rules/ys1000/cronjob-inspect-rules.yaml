apiVersion: kubeeye.kubesphere.io/v1alpha2
kind: InspectRule
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"kubeeye.kubesphere.io/v1alpha2","kind":"InspectRule","metadata":{"annotations":{},"name":"cronjob-inspect-rules"},"spec":{"opas":[{"name":"imagePullPolicyRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n\n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level := \"WARNING\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  policy := container.imagePullPolicy\n  policy != \"IfNotPresent\"\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobImagePullPolicyRule\",\n      \"Reason\": sprintf(\"当前资源镜像拉取策略为: %v , 需要修改为 IfNotPresent \", [policy]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"readinessProbeRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n     \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.readinessProbe\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobReadinessProbeRule\",\n      \"Reason\": \"当前资源没有配置就绪探针\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"livenessProbeRuleForCroneJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.livenessProbe\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobLivenessProbeRule\",\n      \"Reason\": \"当前资源没有配置存活探针\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"hostPathRuleForCroJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"DANGER\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n\n  volume := input.spec.jobTemplate.spec.template.spec.volumes[_]\n\n  \"hostPath\" in volume\n\n  volume_mount := container.volumeMounts[_]\n\n  volume_mount.name == volume.name\n  not volume_mount.readOnly\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPathRule\",\n      \"Reason\": sprintf(\"当前资源使用hostPath挂载卷 , 卷名: %v , 未配置只读模式\", [volume.name]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"privilegedRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"DANGER\"\n\n  input.spec.jobTemplate.spec.template.spec.containers[_].securityContext.privileged == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobPrivilegedRule\",\n      \"Reason\": \"当前资源已启用特权模式\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"insecureCapabilitiesRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n\n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"CRITICAL\"\n\n  insecureCapabilities := [\"CHOWN\", \"DAC_OVERRIDE\", \"FSETID\", \"FOWNER\", \"MKNOD\", \"NET_RAW\", \"SETGID\", \"SETUID\", \"SETFCAP\", \"NET_BIND_SERVICE\",\"SYS_CHROOT\",\"KILL\",\"AUDIT_WRITE\"]\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  capabilities := container.securityContext.capabilities.add[_]\n  insecureCapabilities[_] == capabilities\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobInsecureCapabilitiesRule\",\n      \"Reason\": sprintf(\"容器 '%v' 配置了系统权限: %v\", [container.name, capabilities]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"highRiskCapabilitiesRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"DANGER\"\n  \n  HighRiskCapabilities := [\"NET_ADMIN\", \"SYS_ADMIN\", \"ALL\"]\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  capabilities := container.securityContext.capabilities.add[_]\n  HighRiskCapabilities[_] == capabilities\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHighRiskCapabilitiesRule\",\n      \"Reason\": sprintf(\"容器 '%v' 配置了系统权限: %v\", [container.name, capabilities]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"cpuRequestsRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"WARNING\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.requests.cpu\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobCPURequestsRule\",\n      \"Reason\": sprintf(\"容器 '%v' 未配置CPU资源请求\", [container.name]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"cpuLimitsRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level := \"WARNING\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.limits.cpu\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobCPULimitsRule\",\n      \"Reason\": sprintf(\"容器 '%v' 未配置CPU资源限制\", [container.name]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"memoryRequestsRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.requests.memory\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobMemoryRequestsRule\",\n      \"Reason\": sprintf(\"容器 '%v' 未配置内存资源请求\", [container.name]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"memoryLimitsRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.limits.memory\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobMemoryLimitsRule\",\n      \"Reason\": sprintf(\"容器 '%v' 未配置内存资源限制\", [container.name]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"hostPortRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"CRITICAL\"\n  \n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  port := container.ports[_]\n  port.hostPort\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPortRule\",\n      \"Reason\": sprintf(\"容器 '%v' 使用了 hostPort: %v\", [container.name, port.hostPort]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"hostPIDRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostPID == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPIDRule\",\n      \"Reason\": \"当前资源已启用 hostPID\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"hostNetworkRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostNetwork == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostNetworkRule\",\n      \"Reason\": \"当前资源已启用 hostNetwork\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"hostIPCRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostIPC == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostIPCRule\",\n      \"Reason\": \"当前资源已启用 hostIPC\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"},{"name":"LivenessProbeTimeRuleForCronJob","rule":"package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n  input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level := \"WARNING\"\n  \n  namespace_check(input.metadata.namespace)\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  probe := container.livenessProbe\n  \n  initial_delay := object.get(probe, \"initialDelaySeconds\", 0)\n  period := object.get(probe, \"periodSeconds\", 10)\n  failure_threshold := object.get(probe, \"failureThreshold\", 3)\n  total_time := initial_delay + (failure_threshold * period)\n\n  total_time \u003e= 180\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobLivenessProbeTimeRule\",\n      \"Reason\": sprintf(\"容器 %v 存活探针探测总时间 %vs \u003e= 180s\", [container.name, total_time]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}\n\nnamespace_check(namespace) if {\n    startswith(namespace, \"kubesphere-\")\n}\nnamespace_check(namespace) if {\n    namespace == \"kube-system\"\n}"}]}}
    kubeeye.kubesphere.io/join-plan-num: "0"
  creationTimestamp: "2025-04-25T07:26:03Z"
  finalizers:
  - kubeeye.finalizers.kubesphere.io
  generation: 1
  labels:
    inspection.jibudata.com/rule-category: Application
  name: cronjob-inspect-rules
  resourceVersion: "58410974"
  uid: 7a76ce0d-8ff5-4718-9380-283b0acb2246
spec:
  opas:
  - name: imagePullPolicyRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n\n  input.kind
      == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level := \"WARNING\"\n\n
      \ container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  policy
      := container.imagePullPolicy\n  policy != \"IfNotPresent\"\n\n  msg := {\n      \"Name\":
      sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\",
      [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\", [input.kind]),\n
      \     \"Message\": \"CronJobImagePullPolicyRule\",\n      \"Reason\": sprintf(\"当前资源镜像拉取策略为:
      %v , 需要修改为 IfNotPresent \", [policy]),\n      \"Level\": sprintf(\"%v\", [level])\n
      \ }\n}"
  - name: readinessProbeRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n     \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level
      := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.readinessProbe\n\n
      \ msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\":
      sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\",
      [input.kind]),\n      \"Message\": \"CronJobReadinessProbeRule\",\n      \"Reason\":
      \"当前资源没有配置就绪探针\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"
  - name: livenessProbeRuleForCroneJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.livenessProbe\n\n
      \ msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\":
      sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\",
      [input.kind]),\n      \"Message\": \"CronJobLivenessProbeRule\",\n      \"Reason\":
      \"当前资源没有配置存活探针\",\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}"
  - name: hostPathRuleForCroJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"DANGER\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n\n
      \ volume := input.spec.jobTemplate.spec.template.spec.volumes[_]\n\n  \"hostPath\"
      in volume\n\n  volume_mount := container.volumeMounts[_]\n\n  volume_mount.name
      == volume.name\n  not volume_mount.readOnly\n\n  msg := {\n      \"Name\": sprintf(\"%v\",
      [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n
      \     \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPathRule\",\n
      \     \"Reason\": sprintf(\"当前资源使用hostPath挂载卷 , 卷名: %v , 未配置只读模式\", [volume.name]),\n
      \     \"Level\": sprintf(\"%v\", [level])\n  }\n}"
  - name: privilegedRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"DANGER\"\n\n  input.spec.jobTemplate.spec.template.spec.containers[_].securityContext.privileged
      == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobPrivilegedRule\",\n
      \     \"Reason\": \"当前资源已启用特权模式\",\n      \"Level\": sprintf(\"%v\", [level])\n
      \ }\n}"
  - name: insecureCapabilitiesRuleForCronJob
    rule: |-
      package inspect.kubeeye
      import rego.v1

      deny contains msg if {

        input.kind == "CronJob"
        input.apiVersion == "batch/v1"

        level := "CRITICAL"

        insecureCapabilities := ["CHOWN", "DAC_OVERRIDE", "FSETID", "FOWNER", "MKNOD", "NET_RAW", "SETGID", "SETUID", "SETFCAP", "NET_BIND_SERVICE","SYS_CHROOT","KILL","AUDIT_WRITE"]
        container := input.spec.jobTemplate.spec.template.spec.containers[_]
        capabilities := container.securityContext.capabilities.add[_]
        insecureCapabilities[_] == capabilities

        msg := {
            "Name": sprintf("%v", [input.metadata.name]),
            "Namespace": sprintf("%v", [input.metadata.namespace]),
            "Type": sprintf("%v", [input.kind]),
            "Message": "CronJobInsecureCapabilitiesRule",
            "Reason": sprintf("容器 '%v' 配置了系统权限: %v", [container.name, capabilities]),
            "Level": sprintf("%v", [level])
        }
      }
  - name: highRiskCapabilitiesRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"DANGER\"\n  \n  HighRiskCapabilities := [\"NET_ADMIN\", \"SYS_ADMIN\", \"ALL\"]\n
      \ container := input.spec.jobTemplate.spec.template.spec.containers[_]\n  capabilities
      := container.securityContext.capabilities.add[_]\n  HighRiskCapabilities[_]
      == capabilities\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHighRiskCapabilitiesRule\",\n
      \     \"Reason\": sprintf(\"容器 '%v' 配置了系统权限: %v\", [container.name, capabilities]),\n
      \     \"Level\": sprintf(\"%v\", [level])\n  }\n}"
  - name: cpuRequestsRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"WARNING\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n
      \ not container.resources.requests.cpu\n\n  msg := {\n      \"Name\": sprintf(\"%v\",
      [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n
      \     \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobCPURequestsRule\",\n
      \     \"Reason\": sprintf(\"容器 '%v' 未配置CPU资源请求\", [container.name]),\n      \"Level\":
      sprintf(\"%v\", [level])\n  }\n}"
  - name: cpuLimitsRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level
      := \"WARNING\"\n\n  container := input.spec.jobTemplate.spec.template.spec.containers[_]\n
      \ not container.resources.limits.cpu\n\n  msg := {\n      \"Name\": sprintf(\"%v\",
      [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n
      \     \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobCPULimitsRule\",\n
      \     \"Reason\": sprintf(\"容器 '%v' 未配置CPU资源限制\", [container.name]),\n      \"Level\":
      sprintf(\"%v\", [level])\n  }\n}"
  - name: memoryRequestsRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n  \n  level
      := \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.requests.memory\n\n
      \ msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\":
      sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\",
      [input.kind]),\n      \"Message\": \"CronJobMemoryRequestsRule\",\n      \"Reason\":
      sprintf(\"容器 '%v' 未配置内存资源请求\", [container.name]),\n      \"Level\": sprintf(\"%v\",
      [level])\n  }\n}"
  - name: memoryLimitsRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"WARNING\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  not container.resources.limits.memory\n\n
      \ msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n      \"Namespace\":
      sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\": sprintf(\"%v\",
      [input.kind]),\n      \"Message\": \"CronJobMemoryLimitsRule\",\n      \"Reason\":
      sprintf(\"容器 '%v' 未配置内存资源限制\", [container.name]),\n      \"Level\": sprintf(\"%v\",
      [level])\n  }\n}"
  - name: hostPortRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"CRITICAL\"\n  \n  not input.metadata.namespace == \"kubeeye-system\"\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  port := container.ports[_]\n
      \ port.hostPort\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPortRule\",\n
      \     \"Reason\": sprintf(\"容器 '%v' 使用了 hostPort: %v\", [container.name, port.hostPort]),\n
      \     \"Level\": sprintf(\"%v\", [level])\n  }\n}"
  - name: hostPIDRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostPID
      == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostPIDRule\",\n
      \     \"Reason\": \"当前资源已启用 hostPID\",\n      \"Level\": sprintf(\"%v\", [level])\n
      \ }\n}"
  - name: hostNetworkRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostNetwork
      == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostNetworkRule\",\n
      \     \"Reason\": \"当前资源已启用 hostNetwork\",\n      \"Level\": sprintf(\"%v\",
      [level])\n  }\n}"
  - name: hostIPCRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"CRITICAL\"\n\n  not input.metadata.namespace == \"kubeeye-system\"\n\n  input.spec.jobTemplate.spec.template.spec.hostIPC
      == true\n\n  msg := {\n      \"Name\": sprintf(\"%v\", [input.metadata.name]),\n
      \     \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n      \"Type\":
      sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobHostIPCRule\",\n
      \     \"Reason\": \"当前资源已启用 hostIPC\",\n      \"Level\": sprintf(\"%v\", [level])\n
      \ }\n}"
  - name: LivenessProbeTimeRuleForCronJob
    rule: "package inspect.kubeeye\nimport rego.v1\n\ndeny contains msg if {\n  \n
      \ input.kind == \"CronJob\"\n  input.apiVersion == \"batch/v1\"\n\n  level :=
      \"WARNING\"\n  \n  namespace_check(input.metadata.namespace)\n\n  container
      := input.spec.jobTemplate.spec.template.spec.containers[_]\n  probe := container.livenessProbe\n
      \ \n  initial_delay := object.get(probe, \"initialDelaySeconds\", 0)\n  period
      := object.get(probe, \"periodSeconds\", 10)\n  failure_threshold := object.get(probe,
      \"failureThreshold\", 3)\n  total_time := initial_delay + (failure_threshold
      * period)\n\n  total_time >= 180\n\n  msg := {\n      \"Name\": sprintf(\"%v\",
      [input.metadata.name]),\n      \"Namespace\": sprintf(\"%v\", [input.metadata.namespace]),\n
      \     \"Type\": sprintf(\"%v\", [input.kind]),\n      \"Message\": \"CronJobLivenessProbeTimeRule\",\n
      \     \"Reason\": sprintf(\"容器 %v 存活探针探测总时间 %vs >= 180s\", [container.name,
      total_time]),\n      \"Level\": sprintf(\"%v\", [level])\n  }\n}\n\nnamespace_check(namespace)
      if {\n    startswith(namespace, \"kubesphere-\")\n}\nnamespace_check(namespace)
      if {\n    namespace == \"kube-system\"\n}"
status:
  endImportTime: "2025-04-25T07:26:03Z"
  levelCount:
    warning: 16
  startImportTime: "2025-04-25T07:26:03Z"
  state: ImportComplete
